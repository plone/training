

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>34. Using starzel.votable_behavior in ploneconf.site &mdash; Mastering Plone 1.2.2 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
    <link rel="top" title="Mastering Plone 1.2.2 documentation" href="index.html"/>
        <link rel="next" title="35. Buildout II: Getting ready for deployment" href="deployment_sites.html"/>
        <link rel="prev" title="33. Making our package reusable" href="reusable.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Mastering Plone</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#who-are-we">Who are we?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#who-are-you">Who are you?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-will-we-do">What will we do?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-will-we-not-do">What will we not do?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-to-expect">What to expect</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#further-reading">Further Reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">2. Installation &amp; Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installing-plone">Installing Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#hosting-plone">Hosting Plone</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plone_training_config/instructions.html">3. Installing Plone for the Training</a><ul>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#install-virtualbox">Install VirtualBox</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#install-and-configure-vagrant">Install and configure Vagrant</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#what-vagrant-does">What Vagrant does</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="case.html">4. The Case-Study</a><ul>
<li class="toctree-l2"><a class="reference internal" href="case.html#background">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="case.html#requirements">Requirements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="anatomy.html">5. The Anatomy of Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope2">Zope2</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#content-management-framework">Content Management Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope-toolkit-zope3">Zope Toolkit / Zope3</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope-component-architecture-zca">Zope Component Architecture (ZCA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#pyramid">Pyramid</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="features.html">6. The Features of Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="features.html#starting-and-stopping-plone">Starting and Stopping Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#users">Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#configure-a-mailserver">Configure a Mailserver</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#walktrough-of-the-ui">Walktrough of the UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#content-types">Content-Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#folders">Folders</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#collections">Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#content-rules">Content Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#history">History</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#manage-members-and-groups">Manage members and groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#workflows">Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#working-copy">Working copy</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#placeful-workflows">Placeful workflows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuring_customizing.html">7. Configuring and Customizing Plone through the web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#the-control-panel">The Control Panel</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#portlets">Portlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#viewlets">Viewlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#zmi">ZMI</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">8. Extending Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="extending.html#extension-technologies">Extension technologies</a></li>
<li class="toctree-l2"><a class="reference internal" href="extending.html#what-are-components-what-is-zcml">What are components, what is ZCML</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="addons.html">9. Extend Plone with Add-ons</a><ul>
<li class="toctree-l2"><a class="reference internal" href="addons.html#how-to-find-addons">How to find addons</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#some-noteable-addons">Some noteable addons</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#installing-addons">Installing Addons</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#ploneformgen">PloneFormGen</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#add-photogallery-with-collective-plonetruegallery">Add Photogallery with collective.plonetruegallery</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#internationalisation">Internationalisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theming.html">10. Theming</a></li>
<li class="toctree-l1"><a class="reference internal" href="buildout_1.html">11. Buildout I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#syntax">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#recipes">Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#a-real-life-example">A real life example</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#hello-mr-developer">Hello mr.developer!</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#extensible">Extensible</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#be-mcguyver">Be McGuyver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="eggs1.html">12. Creating addons to customize Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#using-zopeskel-to-create-an-egg">Using zopeskel to create an egg</a></li>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#inspecting-the-package">Inspecting the package</a></li>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#including-the-egg-in-plone">Including the egg in Plone</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dexterity.html">13. Dexterity I: Through the web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#what-is-a-content-type">What is a content-type?</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#dexterity-and-archetypes-a-comparison">Dexterity and Archetypes - A Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#modifying-existing-types">Modifying existing types</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#creating-content-types-ttw">Creating content-types TTW</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#moving-content-types-into-code">Moving content-types into code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_1.html">14. Views I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_1.html#a-simple-browser-view">A simple browser view</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="zpt.html">15. Zope Page Templates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#tal-and-tales">TAL and TALES</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#metal-and-macros">METAL and macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#accessing-plone-from-the-template">Accessing Plone from the template</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#what-we-missed">What we missed</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#chameleon">Chameleon</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="zpt_2.html">16. Customizing existing templates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#newsitem-pt">newsitem.pt</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#summary-view-pt">summary_view.pt</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#finding-the-right-template">Finding the right template</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#skin-templates">skin-templates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_2.html">17. Views II: A default view for &#8220;talk&#8221;</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#view-classes">View-Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#the-default-view">The default-view</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_3.html">18. Views III: A Talk list</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#using-portal-catalog">Using portal_catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#brains-and-objects">brains and objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#querying-the-catalog">Querying the catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#the-template-for-the-listing">The template for the listing</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#setting-a-custom-view-as-default-view-on-an-object">Setting a custom view as default-view on an object</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#adding-some-javascript-collective-js-datatables">Adding some javascript (collective.js.datatables)</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="behaviors1.html">19. Behaviors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="behaviors1.html#dexterity-approach">Dexterity Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors1.html#names-and-theory">Names and Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors1.html#practical-example">Practical example</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors1.html#adding-it-to-our-talk">Adding it to our talk</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="viewlets_1.html">20. Writing Viewlets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="viewlets_1.html#a-viewlet-for-the-social-behavior">A viewlet for the social behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_1.html#social-viewlet">social-viewlet</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">21. Programming Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#plone-api">plone.api</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#portal-tools">portal-tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#debugging">Debugging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ide.html">22. IDE&#8217;s and Editors</a></li>
<li class="toctree-l1"><a class="reference internal" href="dexterity_2.html">23. Dexterity Types II: Growing up</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#add-a-marker-interface-to-the-talk-type">Add a marker-interface to the talk-type</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#upgrade-steps">Upgrade-steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#add-a-browserlayer">Add a browserlayer</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#add-catalog-indexes">Add catalog-indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#query-for-custom-indexes">Query for custom indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#add-collection-criteria">Add collection criteria</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#add-more-features-through-generic-setup">Add more features through generic-setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="custom_search.html">24. Custom search</a><ul>
<li class="toctree-l2"><a class="reference internal" href="custom_search.html#eea-facetednavigation">eea.facetednavigation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="events.html">25. Turn talks into events</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_generated_content.html">26. User generated content</a><ul>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#self-registration">Self-registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#constrain-types">Constrain types</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#grant-local-roles">Grant local roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#a-custom-workflow-for-talks">A custom workflow for talks</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#move-the-changes-to-the-file-system">Move the changes to the file-system</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">27. Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="thirdparty_behaviors.html">28. Using third-party behaviors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="thirdparty_behaviors.html#add-teaser-with-collective-behavior-banner">Add teaser with collective.behavior.banner</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dexterity_3.html">29. Dexterity Types III: Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="eggs2.html">30. Creating reusable packages with eggs</a></li>
<li class="toctree-l1"><a class="reference internal" href="behaviors2.html">31. More complex behaviors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="behaviors2.html#using-annotations">Using Annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors2.html#using-schema">Using Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors2.html#writing-code">Writing Code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="viewlets_2.html">32. A viewlet for the voteable behavior</a><ul>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#voting-viewlet">Voting Viewlet</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#writing-the-viewlet-code">Writing the Viewlet code</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#the-template">The template</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#the-javascript-code">The javascript code</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#writing-2-simple-view-helpers">Writing 2 simple view helpers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reusable.html">33. Making our package reusable</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reusable.html#adding-permissions">Adding permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="reusable.html#using-our-permissions">Using our permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="reusable.html#provide-defaults">Provide defaults</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">34. Using starzel.votable_behavior in ploneconf.site</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment_sites.html">35. Buildout II: Getting ready for deployment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="deployment_sites.html#the-starzel-buildout">The starzel-buildout</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment_sites.html#a-deployment-setup">A deployment-setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment_sites.html#other-tools-we-use">Other tools we use</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="future_of_plone.html">36. The Future of Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="optional.html">37. Optional</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Mastering Plone</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>34. Using starzel.votable_behavior in ploneconf.site</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="using-starzel-votable-behavior-in-ploneconf-site">
<h1>34. Using starzel.votable_behavior in ploneconf.site<a class="headerlink" href="#using-starzel-votable-behavior-in-ploneconf-site" title="Permalink to this headline">Â¶</a></h1>
<ul class="simple">
<li>We want to use the votable behavior, so that our reviewers can vote.</li>
<li>To show how to use events, we are going to auto publish talks that have reached a certain rating.</li>
<li>We are not going to let everybody vote everything.</li>
</ul>
<p>First, we must add our package as a dependency to ploneconf.site.</p>
<p>We do this in two locations. The egg description <tt class="file docutils literal"><span class="pre">setup.py</span></tt> needs <tt class="samp docutils literal"><span class="pre">starzel.votable_behavior</span></tt> as a dependency.
Else no source code will be available.</p>
<p>The persistent configuration needs to be installed when we install our site. This is configured in GenericSetup.</p>
<p>We start with by editing <tt class="file docutils literal"><span class="pre">setup.py</span></tt></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">...</span>
<span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
    <span class="s">&#39;setuptools&#39;</span><span class="p">,</span>
    <span class="s">&#39;plone.app.dexterity [relations]&#39;</span><span class="p">,</span>
    <span class="s">&#39;plone.app.relationfield&#39;</span><span class="p">,</span>
    <span class="s">&#39;plone.namedfile [blobs]&#39;</span><span class="p">,</span>
<span class="hll">    <span class="s">&#39;starzel.votable_behavior&#39;</span><span class="p">,</span>
</span>    <span class="c"># -*- Extra requirements: -*-</span>
<span class="p">],</span>
<span class="o">...</span>
</pre></div>
</td></tr></table></div>
<p>Next up we modify <tt class="file docutils literal"><span class="pre">profiles/default/metadata.xml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;metadata&gt;</span>
  <span class="nt">&lt;version&gt;</span>1002<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>profile-plone.app.dexterity:default<span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>profile-plone.app.relationfield:default<span class="nt">&lt;/dependency&gt;</span>
<span class="hll">      <span class="nt">&lt;dependency&gt;</span>profile-starzel.votable_behavior:default<span class="nt">&lt;/dependency&gt;</span>
</span>    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/metadata&gt;</span>
</pre></div>
</td></tr></table></div>
<p>What a weird name. profile- is a prefix you will always need nowadays. Then comes the egg name, and the part after the colon is the name of the profile. The name of the profile is defined in zcml. So far I&#8217;ve stumbled only over one package where the profile directory name was different to the GenericSetup Profile name.</p>
<p>Now the package is there, but nothing is votable. That is because no content type declares to use this behavior. We can add this behavior via the control panel, export the settings and store it in our egg. Let&#8217;s just add it by hand now.</p>
<p>We have to add the behavior to talks, we do this in <tt class="file docutils literal"><span class="pre">profiles/default/types/talk.xml</span></tt></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Managing dependencies in metadata.xml is good practice. We can&#8217;t rely on remembering what we&#8217;d have to do by hand. For example, do you remember that we had to add to select <tt class="docutils literal"><span class="pre">Dexterity-based</span> <span class="pre">Plone</span> <span class="pre">Default</span> <span class="pre">Types</span></tt> when creating a new Plone-site?</p>
<p class="last">We should instead also add <tt class="docutils literal"><span class="pre">&lt;dependency&gt;profile-plone.app.contenttypes:plone-content&lt;/dependency&gt;</span></tt> like the <a class="reference external" href="http://docs.plone.org/external/plone.app.contenttypes/docs/README.html#installation-as-a-dependency-from-another-product">documentation for plone.app.contenttypes</a> recommends.</p>
</div>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;behaviors&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;plone.app.dexterity.behaviors.metadata.IDublinCore&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;plone.app.content.interfaces.INameFromTitle&quot;</span><span class="nt">/&gt;</span>
<span class="hll">  <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;starzel.votable_behavior.interfaces.IVoting&quot;</span><span class="nt">/&gt;</span>
</span><span class="nt">&lt;/property&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Now we can reinstall our Plone site.</p>
<p>Everybody can vote now on talks. That is not what we wanted. Actually, we want reviewers only to vote on pending Talks. This means, depending on the workflow state, the permission has to change. Luckily, workflows can be configured to do just that.
Talks already have their own workflow. So we won&#8217;t interfere with other packages.</p>
<p>First, we have to tell the workflow that he will be managing more permissions. Next up, we have to configure for each state, which role has the two new permissions now.</p>
<p>That is a very verbose configuration, maybe you want to do it in the web interface and export the settings. On the other hand, it is easy to make a simple mistake in both ways. I will just present xml way here.</p>
<p>The config for the Workflow is in <tt class="file docutils literal"><span class="pre">profiles/default/workfows/talks_workflow.xml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;dc-workflow</span> <span class="na">workflow_id=</span><span class="s">&quot;talks_workflow&quot;</span> <span class="na">title=</span><span class="s">&quot;Talks Workflow&quot;</span> <span class="na">description=</span><span class="s">&quot; - Simple workflow that is useful for basic web sites. - Things start out as private, and can either be submitted for review, or published directly. - The creator of a content item can edit the item even after it is published.&quot;</span> <span class="na">state_variable=</span><span class="s">&quot;review_state&quot;</span> <span class="na">initial_state=</span><span class="s">&quot;private&quot;</span> <span class="na">manager_bypass=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;permission&gt;</span>Access contents information<span class="nt">&lt;/permission&gt;</span>
 <span class="nt">&lt;permission&gt;</span>Change portal events<span class="nt">&lt;/permission&gt;</span>
 <span class="nt">&lt;permission&gt;</span>Modify portal content<span class="nt">&lt;/permission&gt;</span>
 <span class="nt">&lt;permission&gt;</span>View<span class="nt">&lt;/permission&gt;</span>
<span class="hll"> <span class="nt">&lt;permission&gt;</span>starzel.votable_behavior: View Vote<span class="nt">&lt;/permission&gt;</span>
</span><span class="hll"> <span class="nt">&lt;permission&gt;</span>starzel.votable_behavior: Do Vote<span class="nt">&lt;/permission&gt;</span>
</span> <span class="nt">&lt;state</span> <span class="na">state_id=</span><span class="s">&quot;pending&quot;</span> <span class="na">title=</span><span class="s">&quot;Pending review&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;description&gt;</span>Waiting to be reviewed, not editable by the owner.<span class="nt">&lt;/description&gt;</span>
  ...
<span class="hll">  <span class="nt">&lt;permission-map</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: View Vote&quot;</span> <span class="na">acquired=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Site Administrator<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Manager<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Reviewer<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/permission-map&gt;</span>
</span><span class="hll">  <span class="nt">&lt;permission-map</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: Do Vote&quot;</span> <span class="na">acquired=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Site Administrator<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Manager<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Reviewer<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/permission-map&gt;</span>
</span>  ...
 <span class="nt">&lt;/state&gt;</span>
 <span class="nt">&lt;state</span> <span class="na">state_id=</span><span class="s">&quot;private&quot;</span> <span class="na">title=</span><span class="s">&quot;Private&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;description&gt;</span>Can only be seen and edited by the owner.<span class="nt">&lt;/description&gt;</span>
  ...
<span class="hll">  <span class="nt">&lt;permission-map</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: View Vote&quot;</span> <span class="na">acquired=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Site Administrator<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Manager<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/permission-map&gt;</span>
</span><span class="hll">  <span class="nt">&lt;permission-map</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: Do Vote&quot;</span> <span class="na">acquired=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Site Administrator<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Manager<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/permission-map&gt;</span>
</span>  ...
 <span class="nt">&lt;/state&gt;</span>
 <span class="nt">&lt;state</span> <span class="na">state_id=</span><span class="s">&quot;published&quot;</span> <span class="na">title=</span><span class="s">&quot;Published&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;description&gt;</span>Visible to everyone, editable by the owner.<span class="nt">&lt;/description&gt;</span>
  ...
<span class="hll">  <span class="nt">&lt;permission-map</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: View Vote&quot;</span> <span class="na">acquired=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Site Administrator<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Manager<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/permission-map&gt;</span>
</span><span class="hll">  <span class="nt">&lt;permission-map</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: Do Vote&quot;</span> <span class="na">acquired=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/permission-map&gt;</span>
</span>  ...
 <span class="nt">&lt;/state&gt;</span>
  ...
<span class="nt">&lt;/dc-workflow&gt;</span>
</pre></div>
</td></tr></table></div>
<p>We have to reinstall our product again.</p>
<p>But this time, this is not enough. Permissions get updated on workflow changes. As long as a workflow change didn&#8217;t happen, the talks have the same permissions as ever.</p>
<p>Luckily, there is a button for that in the ZMI Workflow view <em class="guilabel">Update security settings</em>.</p>
<p>After clicking on this, only managers and Reviewers can see the Voting functionality.</p>
<p>Lastly, we add our silly function to autoapprove talks.</p>
<p>You quickly end up writing many event handlers, so we put everything into a directory for eventhandlers.</p>
<p>For the events we need a <tt class="file docutils literal"><span class="pre">events</span></tt> directory.</p>
<p>Create the <tt class="file docutils literal"><span class="pre">events</span></tt> directory and add an empty <tt class="file docutils literal"><span class="pre">events/__init__.py</span></tt> file.</p>
<p>Next, register the events directory in <tt class="file docutils literal"><span class="pre">configure.zcml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;include</span> <span class="na">package=</span><span class="s">&quot;.events&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</td></tr></table></div>
<p>then, we write the ZCML configuration for the events into <tt class="file docutils literal"><span class="pre">events/configure.zcml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;configure</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;subscriber</span>
    <span class="na">for=</span><span class="s">&quot;starzel.votable_behavior.interfaces.IVotable</span>
<span class="s">         zope.lifecycleevent.IObjectModifiedEvent&quot;</span>
    <span class="na">handler=</span><span class="s">&quot;.votable.votable_update&quot;</span>
    <span class="nt">/&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</td></tr></table></div>
<p>This looks like a MultiAdapter. We want to get notified, when an IVotable object gets modified. Our method will receive the votable object, and the event itself.</p>
<p>And finally, our event handler in <tt class="file docutils literal"><span class="pre">events/votable.py</span></tt></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.api.content</span> <span class="kn">import</span> <span class="n">transition</span>
<span class="kn">from</span> <span class="nn">plone.api.content</span> <span class="kn">import</span> <span class="n">get_state</span>
<span class="kn">from</span> <span class="nn">starzel.votable_behavior.interfaces</span> <span class="kn">import</span> <span class="n">IVoting</span>


<span class="k">def</span> <span class="nf">votable_update</span><span class="p">(</span><span class="n">votable_object</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="n">votable</span> <span class="o">=</span> <span class="n">IVoting</span><span class="p">(</span><span class="n">votable_object</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">get_state</span><span class="p">(</span><span class="n">votable_object</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;pending&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">votable</span><span class="o">.</span><span class="n">average_vote</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">transition</span><span class="p">(</span><span class="n">votable_object</span><span class="p">,</span> <span class="n">transition</span><span class="o">=</span><span class="s">&#39;publish&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>We are using a lot of plone api here. Plone API makes the code a breeze. Also, there is nothing really interesting.
We will only do something, if the workflow state is pending and the average vote is above 0.5.
As you can see, the <tt class="samp docutils literal"><span class="pre">transition</span></tt> Method does not want the target state, but the transition to move the state to the target state.</p>
<p>There is nothing special going on.</p>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="deployment_sites.html" class="btn btn-neutral float-right" title="35. Buildout II: Getting ready for deployment"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="reusable.html" class="btn btn-neutral" title="33. Making our package reusable"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Philip Bauer, Patrick Gerken. Version 1.2.2.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.2.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>