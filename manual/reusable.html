

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>33. Making our package reusable &mdash; Mastering Plone 1.2.2 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
    <link rel="top" title="Mastering Plone 1.2.2 documentation" href="index.html"/>
        <link rel="next" title="34. Using starzel.votable_behavior in ploneconf.site" href="embed.html"/>
        <link rel="prev" title="32. A viewlet for the voteable behavior" href="viewlets_2.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Mastering Plone</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#who-are-we">Who are we?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#who-are-you">Who are you?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-will-we-do">What will we do?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-will-we-not-do">What will we not do?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-to-expect">What to expect</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#further-reading">Further Reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">2. Installation &amp; Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installing-plone">Installing Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#hosting-plone">Hosting Plone</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plone_training_config/instructions.html">3. Installing Plone for the Training</a><ul>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#install-virtualbox">Install VirtualBox</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#install-and-configure-vagrant">Install and configure Vagrant</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#what-vagrant-does">What Vagrant does</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="case.html">4. The Case-Study</a><ul>
<li class="toctree-l2"><a class="reference internal" href="case.html#background">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="case.html#requirements">Requirements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="anatomy.html">5. The Anatomy of Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope2">Zope2</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#content-management-framework">Content Management Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope-toolkit-zope3">Zope Toolkit / Zope3</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope-component-architecture-zca">Zope Component Architecture (ZCA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#pyramid">Pyramid</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="features.html">6. The Features of Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="features.html#starting-and-stopping-plone">Starting and Stopping Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#users">Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#configure-a-mailserver">Configure a Mailserver</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#walktrough-of-the-ui">Walktrough of the UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#content-types">Content-Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#folders">Folders</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#collections">Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#content-rules">Content Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#history">History</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#manage-members-and-groups">Manage members and groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#workflows">Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#working-copy">Working copy</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#placeful-workflows">Placeful workflows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuring_customizing.html">7. Configuring and Customizing Plone through the web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#the-control-panel">The Control Panel</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#portlets">Portlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#viewlets">Viewlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#zmi">ZMI</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">8. Extending Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="extending.html#extension-technologies">Extension technologies</a></li>
<li class="toctree-l2"><a class="reference internal" href="extending.html#what-are-components-what-is-zcml">What are components, what is ZCML</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="addons.html">9. Extend Plone with Add-ons</a><ul>
<li class="toctree-l2"><a class="reference internal" href="addons.html#how-to-find-addons">How to find addons</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#some-noteable-addons">Some noteable addons</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#installing-addons">Installing Addons</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#ploneformgen">PloneFormGen</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#add-photogallery-with-collective-plonetruegallery">Add Photogallery with collective.plonetruegallery</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#internationalisation">Internationalisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theming.html">10. Theming</a></li>
<li class="toctree-l1"><a class="reference internal" href="buildout_1.html">11. Buildout I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#syntax">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#recipes">Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#a-real-life-example">A real life example</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#hello-mr-developer">Hello mr.developer!</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#extensible">Extensible</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#be-mcguyver">Be McGuyver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="eggs1.html">12. Creating addons to customize Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#using-zopeskel-to-create-an-egg">Using zopeskel to create an egg</a></li>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#inspecting-the-package">Inspecting the package</a></li>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#including-the-egg-in-plone">Including the egg in Plone</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dexterity.html">13. Dexterity I: Through the web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#what-is-a-content-type">What is a content-type?</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#dexterity-and-archetypes-a-comparison">Dexterity and Archetypes - A Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#modifying-existing-types">Modifying existing types</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#creating-content-types-ttw">Creating content-types TTW</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#moving-content-types-into-code">Moving content-types into code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_1.html">14. Views I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_1.html#a-simple-browser-view">A simple browser view</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="zpt.html">15. Zope Page Templates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#tal-and-tales">TAL and TALES</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#metal-and-macros">METAL and macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#accessing-plone-from-the-template">Accessing Plone from the template</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#what-we-missed">What we missed</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#chameleon">Chameleon</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="zpt_2.html">16. Customizing existing templates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#newsitem-pt">newsitem.pt</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#summary-view-pt">summary_view.pt</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#finding-the-right-template">Finding the right template</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#skin-templates">skin-templates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_2.html">17. Views II: A default view for &#8220;talk&#8221;</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#view-classes">View-Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#the-default-view">The default-view</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_3.html">18. Views III: A Talk list</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#using-portal-catalog">Using portal_catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#brains-and-objects">brains and objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#querying-the-catalog">Querying the catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#the-template-for-the-listing">The template for the listing</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#setting-a-custom-view-as-default-view-on-an-object">Setting a custom view as default-view on an object</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#adding-some-javascript-collective-js-datatables">Adding some javascript (collective.js.datatables)</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="behaviors1.html">19. Behaviors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="behaviors1.html#dexterity-approach">Dexterity Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors1.html#names-and-theory">Names and Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors1.html#practical-example">Practical example</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors1.html#adding-it-to-our-talk">Adding it to our talk</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="viewlets_1.html">20. Writing Viewlets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="viewlets_1.html#a-viewlet-for-the-social-behavior">A viewlet for the social behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_1.html#social-viewlet">social-viewlet</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">21. Programming Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#plone-api">plone.api</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#portal-tools">portal-tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#debugging">Debugging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ide.html">22. IDE&#8217;s and Editors</a></li>
<li class="toctree-l1"><a class="reference internal" href="dexterity_2.html">23. Dexterity Types II: Growing up</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#add-a-marker-interface-to-the-talk-type">Add a marker-interface to the talk-type</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#upgrade-steps">Upgrade-steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#add-a-browserlayer">Add a browserlayer</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#add-catalog-indexes">Add catalog-indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#query-for-custom-indexes">Query for custom indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#add-collection-criteria">Add collection criteria</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity_2.html#add-more-features-through-generic-setup">Add more features through generic-setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="custom_search.html">24. Custom search</a><ul>
<li class="toctree-l2"><a class="reference internal" href="custom_search.html#eea-facetednavigation">eea.facetednavigation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="events.html">25. Turn talks into events</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_generated_content.html">26. User generated content</a><ul>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#self-registration">Self-registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#constrain-types">Constrain types</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#grant-local-roles">Grant local roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#a-custom-workflow-for-talks">A custom workflow for talks</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_generated_content.html#move-the-changes-to-the-file-system">Move the changes to the file-system</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">27. Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="thirdparty_behaviors.html">28. Using third-party behaviors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="thirdparty_behaviors.html#add-teaser-with-collective-behavior-banner">Add teaser with collective.behavior.banner</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dexterity_3.html">29. Dexterity Types III: Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="eggs2.html">30. Creating reusable packages with eggs</a></li>
<li class="toctree-l1"><a class="reference internal" href="behaviors2.html">31. More complex behaviors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="behaviors2.html#using-annotations">Using Annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors2.html#using-schema">Using Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors2.html#writing-code">Writing Code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="viewlets_2.html">32. A viewlet for the voteable behavior</a><ul>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#voting-viewlet">Voting Viewlet</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#writing-the-viewlet-code">Writing the Viewlet code</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#the-template">The template</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#the-javascript-code">The javascript code</a></li>
<li class="toctree-l2"><a class="reference internal" href="viewlets_2.html#writing-2-simple-view-helpers">Writing 2 simple view helpers</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">33. Making our package reusable</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#adding-permissions">Adding permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-our-permissions">Using our permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#provide-defaults">Provide defaults</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="embed.html">34. Using starzel.votable_behavior in ploneconf.site</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment_sites.html">35. Buildout II: Getting ready for deployment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="deployment_sites.html#the-starzel-buildout">The starzel-buildout</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment_sites.html#a-deployment-setup">A deployment-setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment_sites.html#other-tools-we-use">Other tools we use</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="future_of_plone.html">36. The Future of Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="optional.html">37. Optional</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Mastering Plone</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>33. Making our package reusable</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="making-our-package-reusable">
<h1>33. Making our package reusable<a class="headerlink" href="#making-our-package-reusable" title="Permalink to this headline">¶</a></h1>
<p>The package contains some problems.</p>
<ul class="simple">
<li>No permission settings, Users can&#8217;t customize who and when users can vote</li>
<li>We do things, but don&#8217;t trigger events. Events allow others to react.</li>
</ul>
<div class="section" id="adding-permissions">
<h2>Adding permissions<a class="headerlink" href="#adding-permissions" title="Permalink to this headline">¶</a></h2>
<p>Permissions have a long history, there are two types of permissions.</p>
<p>In Zope2, a permission was just a string.</p>
<p>In ZTK, a permission is an object that gets registered as an Utility.</p>
<p>We must support both, in some cases we have to reference the permission by their Zope2 version, in some by their ZTK Version.</p>
<p>Luckily, there is a zcml statement to register a permission both ways in one step.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p>The configuration registry wanted to solve a problem, but we will now stumble over a problem that did not get resolved properly.</p>
<p>Our permission is an utility. Our browser views declare this permission as a requirement for viewing them.</p>
<p class="last">When our browser views get registered, the permissions must exist already. If you try to register the permissions after the views, Zope won&#8217;t start because it doesn&#8217;t know about the permissions.</p>
</div>
<p>Lets modify the file <tt class="file docutils literal"><span class="pre">configure.zcml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre>&lt;configure
  ...&gt;

  &lt;includeDependencies package=&quot;.&quot; /&gt;

  &lt;permission
      id=&quot;starzel.votable_behavior.view_vote&quot;
      title=&quot;starzel.votable_behavior: View Vote&quot;
      /&gt;

  &lt;permission
      id=&quot;starzel.votable_behavior.do_vote&quot;
      title=&quot;starzel.votable_behavior: Do Vote&quot;
      /&gt;

<span class="hll">  &lt;include package=&quot;.browser&quot; /&gt;
</span>
  ...

&lt;/configure&gt;
</pre></div>
</td></tr></table></div>
<p>In some places we have to reference the Zope 2 permission strings. It is best practice to provide a static variable for this.</p>
<p>We provide this in <tt class="file docutils literal"><span class="pre">__init__.py</span></tt></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">...</span>
<span class="n">DoVote</span> <span class="o">=</span> <span class="s">&#39;starzel.votable_behavior: Do Vote&#39;</span>
<span class="n">ViewVote</span> <span class="o">=</span> <span class="s">&#39;starzel.votable_behavior: View Vote&#39;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="using-our-permissions">
<h2>Using our permissions<a class="headerlink" href="#using-our-permissions" title="Permalink to this headline">¶</a></h2>
<p>As you can see, we created two permissions, one for voting, one for viewing the votes.</p>
<p>If one may not see the votings, he does not need access to the vote viewlet.</p>
<p>While we are at it, if one can&#8217;t vote, he needs no access to the helper view to actually submit a vote.</p>
<p>We can add this restriction to <tt class="file docutils literal"><span class="pre">browser/configure.zcml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;configure</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span>
  <span class="na">xmlns:browser=</span><span class="s">&quot;http://namespaces.zope.org/browser&quot;</span>
  <span class="na">i18n_domain=</span><span class="s">&quot;starzel.votable_behavior&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;browser:viewlet</span>
    <span class="na">name=</span><span class="s">&quot;voting&quot;</span>
    <span class="na">for=</span><span class="s">&quot;starzel.votable_behavior.interfaces.IVotable&quot;</span>
    <span class="na">manager=</span><span class="s">&quot;plone.app.layout.viewlets.interfaces.IBelowContentTitle&quot;</span>
    <span class="na">template=</span><span class="s">&quot;templates/voting_viewlet.pt&quot;</span>
    <span class="na">layer=</span><span class="s">&quot;..interfaces.IVotableLayer&quot;</span>
    <span class="na">class=</span><span class="s">&quot;.viewlets.Vote&quot;</span>
<span class="hll">    <span class="na">permission=</span><span class="s">&quot;starzel.votable_behavior.view_vote&quot;</span>
</span>    <span class="nt">/&gt;</span>

  <span class="nt">&lt;browser:page</span>
    <span class="na">name=</span><span class="s">&quot;vote&quot;</span>
    <span class="na">for=</span><span class="s">&quot;starzel.votable_behavior.interfaces.IVotable&quot;</span>
    <span class="na">layer=</span><span class="s">&quot;..interfaces.IVotableLayer&quot;</span>
    <span class="na">class=</span><span class="s">&quot;.vote.Vote&quot;</span>
<span class="hll">    <span class="na">permission=</span><span class="s">&quot;starzel.votable_behavior.do_vote&quot;</span>
</span>    <span class="nt">/&gt;</span>

  ...

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</td></tr></table></div>
<p>We are configuring components, so we use the component name of the permission, which is the <tt class="samp docutils literal"><span class="pre">id</span></tt> part of the declaration we added earlier.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p>So, what happens, if we do not protect the browser view to vote?</p>
<p>The person could still vote, by handcrafting the URL. Browser Views run code without any restriction, it is your job to take care of security.</p>
<p>But... if a person has no access to the object at all, maybe because the site is configured that Anonymous users cannot access private objects, the unauthorized users will not be able to submit a vote.</p>
<p class="last">That is, because Zope checks security permissions when trying to find the right object. If it can&#8217;t find the object due to security constraints not met, no view ill ever be called, because that would have been the next step.</p>
</div>
<p>We now protect our views and viewlets. We still show the option to vote though.</p>
<p>We must add a condition in our page template, and we must provide the condition information in our viewlet class.</p>
<p>Lets move on to <tt class="file docutils literal"><span class="pre">browser/viewlets.py</span></tt></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">...</span>

<span class="kn">from</span> <span class="nn">starzel.votable_behavior</span> <span class="kn">import</span> <span class="n">DoVote</span>


<span class="k">class</span> <span class="nc">Vote</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">ViewletBase</span><span class="p">):</span>

     <span class="o">...</span>
<span class="hll">     <span class="n">can_vote</span> <span class="o">=</span> <span class="bp">None</span>
</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="o">...</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_manager</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">membership_tool</span> <span class="o">=</span> <span class="n">getToolByName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="s">&#39;portal_membership&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_manager</span> <span class="o">=</span> <span class="n">membership_tool</span><span class="o">.</span><span class="n">checkPermission</span><span class="p">(</span>
                <span class="n">ViewManagementScreens</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
<span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">can_vote</span> <span class="o">=</span> <span class="n">membership_tool</span><span class="o">.</span><span class="n">checkPermission</span><span class="p">(</span>
</span><span class="hll">                <span class="n">DoVote</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
</span>
<span class="o">...</span>
</pre></div>
</td></tr></table></div>
<p>And the template in <tt class="file docutils literal"><span class="pre">browser/templates/voting_viewlet.pt</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;tal:snippet</span> <span class="na">omit-tag=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;voting&quot;</span><span class="nt">&gt;</span>

    ...

    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;notyetvoted&quot;</span> <span class="na">class=</span><span class="s">&quot;voting_option&quot;</span>
<span class="hll">            <span class="na">tal:condition=</span><span class="s">&quot;view/can_vote&quot;</span><span class="nt">&gt;</span>
</span>      What do you think of this talk?
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;votes&quot;</span><span class="nt">&gt;&lt;span</span> <span class="na">id=</span><span class="s">&quot;voting_plus&quot;</span><span class="nt">&gt;</span>+1<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">&quot;voting_neutral&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">&quot;voting_negative&quot;</span><span class="nt">&gt;</span>-1<span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;no_ratings&quot;</span> <span class="na">tal:condition=</span><span class="s">&quot;not: view/has_votes&quot;</span><span class="nt">&gt;</span>
<span class="hll">      This talk has not been voted yet.<span class="nt">&lt;span</span> <span class="na">tal:omit-tag=</span><span class="s">&quot;&quot;</span> <span class="na">tal:condition=</span><span class="s">&quot;view/can_vote&quot;</span><span class="nt">&gt;</span> Be the first!<span class="nt">&lt;/span&gt;</span>
</span>    <span class="nt">&lt;/div&gt;</span>

  ...

  <span class="nt">&lt;/div&gt;</span>

...

<span class="nt">&lt;/tal:snippet&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Sometimes subtle bugs come up because of changes, in this case, I noticed that I should only animate people to vote, if they are allowed to vote!</p>
</div>
<div class="section" id="provide-defaults">
<h2>Provide defaults<a class="headerlink" href="#provide-defaults" title="Permalink to this headline">¶</a></h2>
<p>Are we done yet? Who may vote now?</p>
<p>We have to tell that someone.</p>
<p>Who has which permissions is managed in Zope, it is persistent, persistent stuff goes to GenericSetup.</p>
<p>The persistent configuration is managed in another file: <tt class="file docutils literal"><span class="pre">profiles/default/rolemap.xml</span></tt></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;rolemap&gt;</span>
  <span class="nt">&lt;permissions&gt;</span>
    <span class="nt">&lt;permission</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: View Vote&quot;</span> <span class="na">acquire=</span><span class="s">&quot;True&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;role</span> <span class="na">name=</span><span class="s">&quot;Anonymous&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/permission&gt;</span>
    <span class="nt">&lt;permission</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: Do Vote&quot;</span> <span class="na">acquire=</span><span class="s">&quot;True&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;role</span> <span class="na">name=</span><span class="s">&quot;Anonymous&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/permission&gt;</span>
  <span class="nt">&lt;/permissions&gt;</span>
<span class="nt">&lt;/rolemap&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="embed.html" class="btn btn-neutral float-right" title="34. Using starzel.votable_behavior in ploneconf.site"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="viewlets_2.html" class="btn btn-neutral" title="32. A viewlet for the voteable behavior"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Philip Bauer, Patrick Gerken. Version 1.2.2.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.2.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>